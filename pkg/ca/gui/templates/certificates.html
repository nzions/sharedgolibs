{{define "content"}}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
    <h2>Issued Certificates</h2>
    <a href="/ui/generate" class="btn btn-success">üîê Generate New Certificate</a>
</div>

{{if .Certificates}}
<div style="margin-bottom: 16px;">
    <strong>{{len .Certificates}}</strong> certificate{{if ne (len .Certificates) 1}}s{{end}} issued
</div>

<table class="table">
    <thead>
        <tr>
            <th>Service Name</th>
            <th>Domains</th>
            <th>Serial Number</th>
            <th>Issued</th>
            <th>Expires</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {{range .Certificates}}
        <tr>
            <td><strong>{{.ServiceName}}</strong></td>
            <td>
                <div style="max-width: 300px; overflow: hidden;">
                    {{range $index, $domain := .Domains}}
                    {{if $index}}<br />{{end}}
                    <code style="font-size: 12px;">{{$domain}}</code>
                    {{end}}
                </div>
            </td>
            <td><code style="font-size: 12px;">{{.SerialNumber}}</code></td>
            <td>{{.IssuedAt.Format "2006-01-02 15:04"}}</td>
            <td>{{.ExpiresAt.Format "2006-01-02 15:04"}}</td>
            <td>
                {{if .IsExpired}}
                <span class="badge badge-danger">Expired</span>
                {{else if .IsExpiringSoon}}
                <span class="badge badge-warning">Expiring Soon</span>
                {{else}}
                <span class="badge badge-success">Valid</span>
                {{end}}
            </td>
            <td>
                <button class="btn" style="padding: 6px 12px; font-size: 12px;"
                    hx-get="/ui/cert-details/{{.SerialNumber}}" hx-target="#cert-modal-content" hx-trigger="click"
                    onclick="document.getElementById('cert-modal').style.display='block'">
                    View Details
                </button>
            </td>
        </tr>
        {{end}}
    </tbody>
</table>
{{else}}
<div class="card">
    <div style="text-align: center; padding: 40px; color: #86868b;">
        <div style="font-size: 48px; margin-bottom: 16px;">üîê</div>
        <h3>No Certificates Issued Yet</h3>
        <p style="margin: 16px 0;">Generate your first certificate to get started with the CA.</p>
        <a href="/ui/generate" class="btn btn-success">Generate Certificate</a>
    </div>
</div>
{{end}}

<!-- Certificate Details Modal -->
<div id="cert-modal" style="
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
">
    <div style="
        background-color: white;
        margin: 5% auto;
        padding: 0;
        border-radius: 12px;
        width: 80%;
        max-width: 800px;
        max-height: 80vh;
        overflow-y: auto;
    ">
        <div
            style="padding: 24px; border-bottom: 1px solid #d2d2d7; display: flex; justify-content: space-between; align-items: center;">
            <h3>Certificate Details</h3>
            <button onclick="document.getElementById('cert-modal').style.display='none'" style="
                background: none;
                border: none;
                font-size: 24px;
                cursor: pointer;
                color: #86868b;
            ">&times;</button>
        </div>
        <div id="cert-modal-content" style="padding: 24px;">
            <!-- Content loaded via HTMX -->
        </div>
    </div>
</div>

<script>
    // Close modal when clicking outside
    document.getElementById('cert-modal').addEventListener('click', function (e) {
        if (e.target === this) {
            this.style.display = 'none';
        }
    });
</script>
{{end}}